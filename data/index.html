<!DOCTYPE html>
<html>
<head><title>OVERSEER::IMU--\>>Dashboard </title></head>
<body>
<h1>Hello from ESP32</h1>
<pre id="info"></pre>
<script>
    fetch('/api/config')
      .then(r => r.json())
      .then(d => {
        document.getElementById('info').textContent = JSON.stringify(d, null, 2);
      });

    async function updateIMU() {
      try {
        const res = await fetch('/imu');
        const data = await res.json();

        const set = (id, val) => document.getElementById(id).textContent = val.toFixed(2);

        set("imu-max-x", data.lifetime_max_g.x);
        set("imu-max-y", data.lifetime_max_g.y);
        set("imu-max-z", data.lifetime_max_g.z);

        set("imu-1s-x", data.rolling_max["1s"].x);
        set("imu-1s-y", data.rolling_max["1s"].y);
        set("imu-1s-z", data.rolling_max["1s"].z);

        set("imu-5s-x", data.rolling_max["5s"].x);
        set("imu-5s-y", data.rolling_max["5s"].y);
        set("imu-5s-z", data.rolling_max["5s"].z);

        set("imu-10s-x", data.rolling_max["10s"].x);
        set("imu-10s-y", data.rolling_max["10s"].y);
        set("imu-10s-z", data.rolling_max["10s"].z);

        document.getElementById("imu-total").textContent = data.stats.total_samples;
        document.getElementById("imu-dropped").textContent = data.stats.dropped_samples;
        document.getElementById("imu-rate").textContent = data.stats.samples_per_second.toFixed(1);
      } catch (e) {
        console.warn("Failed to fetch IMU:", e);
      }
    }
    // Update every 2 seconds
    setInterval(updateIMU, 2000);
    updateIMU();  

    async function updateSystemStats() {
    try {
      const res = await fetch('/api/system');
      const data = await res.json();
      document.getElementById('freeHeap').textContent = `${data.free_heap} bytes`;
      document.getElementById('stackWatermark').textContent = `${data.stack_high_watermark} bytes`;
    } catch (e) {
      console.error('Failed to fetch system diagnostics:', e);
    }
  }

  setInterval(updateSystemStats, 5000); // update every 5s
  updateSystemStats(); // fetch once at load

</script>
<section id="imu-section" class="card">
  <h2 class="text-xl font-bold mb-2">IMU Diagnostics</h2>

  <div class="grid grid-cols-3 gap-4">
    <div>
      <h3 class="font-semibold">Lifetime Max G</h3>
      <p>X: <span id="imu-max-x">0</span> g</p>
      <p>Y: <span id="imu-max-y">0</span> g</p>
      <p>Z: <span id="imu-max-z">0</span> g</p>
    </div>

    <div>
      <h3 class="font-semibold">Rolling Max (1s)</h3>
      <p>X: <span id="imu-1s-x">0</span> g</p>
      <p>Y: <span id="imu-1s-y">0</span> g</p>
      <p>Z: <span id="imu-1s-z">0</span> g</p>
    </div>

    <div>
      <h3 class="font-semibold">Rolling Max (5s)</h3>
      <p>X: <span id="imu-5s-x">0</span> g</p>
      <p>Y: <span id="imu-5s-y">0</span> g</p>

<section id="dx">
  <h2>System Diagnostics</h2>
  <div>
    <strong>Free Heap:</strong> <span id="freeHeap">Loading...</span><br>
    <strong>Stack High Water Mark:</strong> <span id="stackWatermark">Loading...</span>
  </div>
</section>

</body>
</html>
